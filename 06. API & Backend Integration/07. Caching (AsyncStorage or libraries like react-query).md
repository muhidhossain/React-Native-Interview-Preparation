# Caching in React Native (AsyncStorage / react-query) â€” Interview Preparation

**Caching** is the technique of storing data locally so that your app can load information faster, reduce network calls, and work better offline. In React Native, caching is especially important because mobile devices often face slow networks, poor connectivity, and limited resources.

---

## âœ… 1. Why Caching Matters in React Native

Interviewers expect answers like:

- Reduces network requests
- Improves performance & responsiveness
- Supports offline-first functionality
- Reduces latency
- Saves battery & data usage

---

## âœ… 2. AsyncStorage for Caching (Low-level caching)

### What is AsyncStorage?

A simple, unencrypted, persistent **keyâ€“value storage system**.

- Works similarly to `localStorage` but asynchronous.
- Suitable for caching small to medium-sized JSON data, tokens, user settings.

### When to use AsyncStorage:

- Store small cached data (e.g., user preferences).
- Cache API responses manually.
- Save authentication tokens.
- Persist user state between app launches.

### How AsyncStorage works (simple example):

```javascript
import AsyncStorage from '@react-native-async-storage/async-storage';

// Save cache
await AsyncStorage.setItem('user', JSON.stringify(userData));

// Read cache
const cachedUser = await AsyncStorage.getItem('user');
```

### â— Limitations of AsyncStorage:

- Not designed for complex data caching logic
- No built-in stale-while-revalidate
- No automatic cache invalidation
- Not ideal for large data (e.g., image caching)

---

## âœ… 3. react-query (TanStack Query) â€” High-level caching

### What is react-query?

A powerful data-fetching and caching library used in React & React Native.
Handles caching automatically with smart rules.

### ðŸ”¥ What react-query provides:

- Automatic caching
- Background re-fetching
- Stale vs fresh data handling
- Retry on network failure
- Cache invalidation
- Offline support (when combined with persistence plugins)

### Example of caching with react-query:

```javascript
import { useQuery } from "@tanstack/react-query";

const fetchUser = async () => {
  const res = await fetch("https://example.com/user");
  return res.json();
};

function MyComp() {
  const { data, isLoading } = useQuery({
    queryKey: ["user"],
    queryFn: fetchUser,
    staleTime: 1000 * 60 * 5, // 5 minutes cache
  });

  return ...
}
```

### ðŸ§  How caching works in react-query:

**staleTime**

- How long cached data is considered fresh.
- No re-fetch unless expired.

**cacheTime**

- How long unused data stays in memory before garbage collection.

**automatic refetching**

- When the user returns to the screen.
- On app focus.
- On network reconnection.

### react-query with persistence (AsyncStorage)

Use:
`@tanstack/query-async-storage-persister`

This creates a persistent offline cache.

---

## ðŸ“Œ 4. When to Use What? (Interview Strong Answer)

| Use case                    | AsyncStorage | react-query                |
| --------------------------- | ------------ | -------------------------- |
| Small keyâ€“value storage     | âœ…           | âŒ                         |
| Manual API response caching | âœ…           | âŒ                         |
| Complex API caching         | âŒ           | âœ…                         |
| Automatic refetching        | âŒ           | âœ…                         |
| Offline support             | âš ï¸ Manual    | âœ… With persistence plugin |
| Cache invalidation          | âŒ           | âœ…                         |
| Data freshness mgmt         | âŒ           | âœ…                         |

### If asked in interview:

**Q: Should I use AsyncStorage or react-query?**

**Answer:**

> Use **AsyncStorage** for simple, manual caching (tokens, flags, user preferences).
>
> Use **react-query** when you need smart caching, auto refetching, stale-while-revalidate, and offline caching.

---

## ðŸ§  5. Real Interview Example Answer

> "Caching in React Native is used to improve performance, reduce network usage, and enable offline-first behavior. For simple key-value caching like tokens or user settings, I use **AsyncStorage**. For caching API responses, I prefer **react-query** because it automatically manages stale data, background refetching, retries, cache invalidation, and offline support. With the async-storage persister, react-query caches persist even after the app restarts. This combination provides a robust caching system suitable for production apps."
