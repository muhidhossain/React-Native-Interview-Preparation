# Token (JWT) Workflow in React Native

---

## What is a JWT?

A **JWT (JSON Web Token)** is a compact, self-contained token used to securely transmit user identity and authorization data between client and server.

A JWT has three parts:

```
header.payload.signature
```

- **Header** → token type & algorithm (e.g., HS256)
- **Payload** → user data (userId, role, expiry)
- **Signature** → verifies authenticity (server secret/private key)

✅ **JWTs are stateless** → the server does not store session data.

---

## JWT Authentication Workflow (Step-by-Step)

### 1️⃣ User Login

The user logs in from a React Native app using:

```
email + password
```

➡ Sent securely to backend over **HTTPS**.

---

### 2️⃣ Server Verifies Credentials

The backend:

- Validates email & password
- If valid, generates:
  - **Access Token (JWT)** – short-lived (e.g., 15 mins)
  - **Refresh Token** – long-lived (e.g., 7–30 days)

---

### 3️⃣ Tokens Sent to Mobile App

Server response:

```json
{
  "accessToken": "jwt_here",
  "refreshToken": "refresh_token_here"
}
```

---

### 4️⃣ Store Tokens Securely (React Native)

⚠️ **Never store tokens in AsyncStorage in production**

✅ **Recommended:**

- **Expo** → SecureStore
- **Bare React Native** → react-native-keychain

```javascript
await SecureStore.setItemAsync('accessToken', token);
```

---

### 5️⃣ Making Authenticated API Requests

For protected APIs, attach the access token:

```http
Authorization: Bearer <accessToken>
```

In Axios:

```javascript
axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;
```

---

### 6️⃣ Token Validation (Backend)

The server:

- Verifies token signature
- Checks expiration (`exp`)
- Grants access if valid

✅ **No DB lookup required** → fast & scalable.

---

### 7️⃣ Access Token Expires

If access token expires:

```
401 Unauthorized
```

➡ App uses **refresh token** to get a new access token.

---

### 8️⃣ Refresh Token Flow

The app sends:

```json
{
  "refreshToken": "refresh_token_here"
}
```

Server:

- Validates refresh token
- Issues **new access token**
- (Optionally rotates refresh token)

✅ User stays logged in without re-authentication.

---

### 9️⃣ Logout

On logout:

- Delete stored tokens from device
- Backend may **blacklist** refresh token

---

## Diagram (Interview Friendly)

```
Login
 ↓
Server validates credentials
 ↓
JWT issued (Access + Refresh)
 ↓
Store securely on device
 ↓
Authorization: Bearer <JWT>
 ↓
API access
 ↓
JWT expires → Refresh token
 ↓
New JWT issued
```

---

## Why JWT is Popular for Mobile Apps

- ✅ Stateless & scalable
- ✅ Works well with REST APIs
- ✅ No session storage on server
- ✅ Ideal for microservices

---

## Common Interview Follow-ups (Very Important)

### ❓ Why not store JWT in AsyncStorage?

- Vulnerable to XSS & token theft
- ✅ SecureStore / Keychain is encrypted

---

### ❓ Access vs Refresh Token?

| Access Token            | Refresh Token         |
| ----------------------- | --------------------- |
| Short-lived             | Long-lived            |
| Sent with every request | Used only for renewal |
| Can expire quickly      | More sensitive        |

---

### ❓ How do you handle token refresh in React Native?

✅ **Axios interceptor:**

1. Catch 401
2. Call refresh API
3. Retry original request

---

### ❓ JWT vs Session Auth?

| JWT               | Session                         |
| ----------------- | ------------------------------- |
| Stateless         | Stateful                        |
| Better for mobile | Better for server-rendered apps |
| Faster scaling    | Simpler invalidation            |

---

## One-Line Interview Answer

> "JWT-based auth in React Native involves logging in to obtain an access and refresh token, securely storing them on the device, attaching the access token to API requests, and refreshing it automatically when it expires."
